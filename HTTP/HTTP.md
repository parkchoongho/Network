# HTTP

## 1. HTTP 기초

### 1-1. HTTP란?

전 세계의 웹 브라우저, 서버, 웹 애플리케이션은 모두 HTTP(Hyper Text Transfer Protocol)를 통해 대화합니다. 수십억개의 이미지, HTML, 페이지, 텍스트 파일, 동영상 등등의 자료들이 쉴새없이 인터넷 사이사이를 이동하고 있습니다. HTTP는 송수신중 데이터를 파괴, 중복, 왜곡하는 것을 방지하기에 걱정하지 않아도 됩니다. 

### 1-2. 웹클라이언트와 서버

클라이언트가 만약 서버에 HTTP요청을 보내면 서버는 이에 맞는 HTTP 응답을 클라이언트에 돌려줍니다. 이렇게 클라이언트와 서버는 웹세계를 이루는 기본 요소라 할 수 있습니다. 예를 들어, "https://www.oreilly.com/index.html" 페이지를 요청하면 이 요청을 "https://www.oreilly.com" 서버로 보내고 서버는 그 요청에 대한 응답을 찾고 성공하면 타입, 길이 등의 정보를 담아서 다시 클라이언트에 돌려주는 역할을 합니다. 

### 1-3. 리소스

웹 서버는 웹 리소스를 저장하고 관리하는 역할을 합니다. 가장 간단한 형태의 웹 리소스는 웹 서버 파일 시스템의 정적 파일입니다. 하지만 리소스가 항상 정적 파일일 필요는 없습니다. 요청에 따라 다르게 반응하는 프로그램도 가능합니다. 이렇게 리소스는 어떤 서버 파일 시스템에 저장되어 있는 사진, 동영상과 같은 정적 파일일 수도 있으며, 주식거래, 부동산 데이터 검색 등과 같은 프로그램이 될 수도 있습니다. 

### 1-3-1. 미디어 타입

인터넷에는 수천가지의 데이터 타입이 있습니다. HTTP는 웹에서 전송되는 객체 각각에 MIME 라는 데이터 포맷 라벨을 붙힙니다. MIME(Multipurpose Internet Mail Extensions, 다용도 메일 확장)는 원래 서로 다른 메일 시스템간의 통신을 위해 고안되었고, HTTP에서도 멀티미디어 콘텐츠를 기술하고 라벨을 붙이기 위한 용도로 사용되기 시작했습니다. 웹 서버는 모든 HTTP 객체에 라벨을 붙힙니다. 브라우저는 객체를 돌려받은 후, 자신이 처리할 수 있는 객체인지 MIME를 보고 판단합니다. MIME 타입은 사선(/)으로 구분되어 주 타입 부 타입으로 나뉩니다.

- text/html => HTML로 작성된 텍스트 문서
- text/plain => plain ASCII 텍스트 문서
- image/jpeg => JPEG 이미지

### 1-3-2. URI

웹 리소스는 각자 이름을 가지고 있기 때문에 클라이언트는 특정 리소스를 지목할 수 있습니다. 서버의 리소스 이름은 URI(Uniform Resource Identifier)라 칭합니다. URI는 인터넷 우편물 주소 같은 것으로, 리소스를 고유하게 식별하고 위치를 지정할 수 있습니다.  

(ex https://www.joes-hardware.com/specials/saw-blade.gif)

URI는 크게 URL과 URN 2가지로 분류됩니다.

### 1-3-3. URL

URL (Uniform Resource Locator)는 리소스 식별자의 가장 일반적인 형태입니다. URL은 특정 서버 하나의 리소스에 대한 위치를 알려줍니다. URL은 리소스가 정확히 어디에 있고 어떻게 접근해야 되는지를 알려줍니다.

| URL                                                          | 설명                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| https://www.oreilly.com/index.html                           | 오라일리 출판사 홈페이지 URL                                 |
| https://www.yahoo.com/images/logo.gif                        | Yahoo! 웹 사이트 로고 URL                                    |
| https://www.joes-hardware.com/inventory-check.cgi?item=12731 | 물품 #12731 재고가 있는지 확인하는 프로그램 URL              |
| ftp://joe:tools4u@ftp.joes-hardware.com/locking-pliers.gif   | 비밀번호로 보호되는 FTP를 통해 locking-pliers.gif 이미지 파일 접근 URL |

대부분 URL 포맷은 세부분으로 이루어져 있습니다.

- URL의 첫 부분은 스킴(Scheme)이라 하는데 리소스에 접근하기 위해 필요한 프로토콜을 명시한다. 보통은 http이다.(http://)
- 두번째 부분은 서버 인터넷 주소를 알려준다.(www.joes-hardware.com)
- 마지막 부분은 웹 서버 리소스를 가리킨다.(/specials/saw-blade.gif)

오늘날 대부분 URI는 URL이라고 보면 됩니다.

### 1-3-4.URN

URN(Uniform Resource Name)은 하나의 리소스 관련해서 위치에 영향을 받지 않는 유일한 이름 역할을 합니다. URN는 리소스를 여기저기 옮겨도 문제없이 동작합니다. 리소스 이름을 계속 유지한다면, 여러 프로토콜로 접근해도 괜찮습니다. URN은 아직 실험중인 체계이기에 보통 오늘날 URI는 URL을 의미합니다.

### 1-4. 트랜잭션

HTTP 트랜잭션은 요청 명령과 응답결과로 이루어져 있습니다. 이러한 프로세스는 HTTP 메세지라는 정형화된 데이터 형태로 이루어집니다.

요청 명령

```http
GET /specials/saw-blade.gif HTTP/1.0
Host: www.joes-hardware.com
```

응답 결과

```http
HTTP/1.0 200 OK
Content-type: image/gif
Content-length: 8572
```

### 1-4-1 메서드

HTTP는 HTTP 메서드라 불리는 여러가지 요청 명령을 지원합니다. 모든 HTTP 요청은 한 개의 메서드를 가지게 되는데 메서드는 서버가 어떤 동작을 취해야 하는지 알려주는 역할을 합니다.  밑에는 흔히 쓰이는 HTTP 메서드 5가지를 표로 정리한 것입니다.

| HTTP 메서드 | 설명                                                         |
| ----------- | ------------------------------------------------------------ |
| GET         | 서버에서 클라이언트로 지정한 리소스를 보내라.                |
| PUT         | 클라이언트에서 서버로 보낸 데이터를 지정한 이름의 리소스로 지정하라. |
| DELETE      | 지정한 리소스를 서버에서 삭제하라.                           |
| POST        | 클라이언트 데이터를 서버 게이트웨이 애플리케이션으로 보내라. |
| HEAD        | 지정한 리소스에 대한 응답에서, HTTP 헤더 부분만 보내라.      |

### 1-4-2. 상태코드

모든 HTTP 응답 메세지는 상태코드를 동반합니다. 상태코드는 클라이언트에게 요청이 성공했는지, 실패했는지, 추가 조치가 필요한지 등을 알려주는 세자리 숫자입니다. 밑에는 흔히 쓰이는 상태코드를 정리해 놓은 표입니다.

| HTTP 상태코드 | 설명                                        |
| ------------- | ------------------------------------------- |
| 200           | Good. 문서가 바르게 반환 되었음.            |
| 302           | 다시 보내라. 다른 곳에서 리소스를 가져가라. |
| 404           | 없음. 리소스를 찾을 수 없다.                |

HTTP는 각 숫자 상태  코드에 텍스트로 구성된 사유구절도 함께 보냅니다. 이 구문은 설명만을 위한 것이며 실제 응답 처리에는 숫자로 된 코드가 사용됩니다.

### 1-4-3. 여러 객체로 구성된 웹 페이지

애플리케이션은 하나의 작업을 수행할 때, 여러개의 HTTP 트랜잭션을 수행해야 되기도 합니다. 예를 들어, index.html 파일을 가져오는 작업을 수행할 때, 그 파일에 있는 이미지의 URL이 다른 서버에 있는 것이라면 그에 맞는 추가적인 HTTP 트랜잭션을 수행해야 합니다. 이렇게 보통 하나의 웹페이지는 하나의 리소스가 아닌 여러 리소스의 모음일 가능성이 높습니다.

### 1-5. 메시지

HTTP 메시지는 줄단위의 문자열입니다. 이진 형식이 아닌 일반 텍스트이기 때문에 사람이 읽고 쓰기 쉽습니다. 클라이언트가 서버로 보낸 HTTP 메시지를 요청 메시지라 합니다. 서버에서 클라이언트로 가는 메시지는 응답 메시지라고 부릅니다. 그외의 메시지는 없습니다. 요청, 응답 메시지의 형식은 굉장히 비슷합니다.

요청 메시지

```http
GET /test/hi-there.txt HTTP/1.0
Accept: text/*
Accept-Language: en, fr
```

응답 메시지

```http
HTTP/1.0 200 OK
Content-type: text/plain
Content-length: 19

Hi! I'm a message!
```

**시작줄**

메시지의 첫줄은 시작줄이라고 하며, 요청 메시지는 무엇을 해야 하는지 응답 메시지는 무슨 일이 일어 났는지를 나타냅니다.

**헤더**

시작줄 다음에는 0개 이상의 헤더 필드들이 나타납니다. 각 헤더 필드는 쉬운 구문 분석을 위해 쌍점(:)으로 구분되어 하나의 이름과 하나의 값으로 구성됩니다. 헤더 필드를 추가하려면 한줄을 추가하면 되고 헤더는 빈줄로 끝납니다.

**본문**

헤더의 빈줄 다음에는 어떤 종류의 데이터든 들어갈 수 있는 메시지 본문이 필요에 따라 올 수 있습니다. 요청의 본문은 웹 서버로 데이터를 실어 보내며, 응답의 본문은 클라이언트로 데이터를 반환합니다. 구조적이고 문자열인 시작줄이나 헤더와는 달리, 본문은 임의의 이진데이터(이미지, 비디오, 오디오, 소프트웨어등등)도 포함될 수 있습니다.

### 1-6. TCP 커넥션

### 1-6-1. TCP/IP

HTTP는 애플리케이션 계층 프로토콜입니다. HTTP는 네트워크 통신 내부 핵심사항에 대해 신경쓰지 않습니다. 대신 이 부분을 인터넷 전송 프로토콜인 TCP/IP가 맡습니다. 

TCP는 다음과 같은 부분을 제공합니다.

- 오류 없는 데이터 전송
- 순서에 맞는 전달 (데이터는 언제나 보낸 순서대로 도착한다)
- 조각나지 않는 데이터 스트림(언제든 어떤 크기로든 보낼 수 있다)

인터넷 자체가 TCP/IP에 기초하고 있습니다. TCP/IP는 TCP와 IP가 층을 이루고 있는 패킷 교환 프로토콜 집합입니다. TCP/IP는 각 네트워크와 하드웨어의 특성을 숨기고, 어떤 종류의 컴퓨터나 네트워크든 서로 신뢰성 있는 의사소통을 하게 도와줍니다. 일단 TCP 커넥션이 이루어지면, 클라이언트와 서버 컴퓨터간에 송수신된 메시지가 없어지거나 손상되거나 순서가 뒤바뀌는 일은 없어집니다. 네트워크 개념상, HTTP 프로토콜은 TCP 위의 계층입니다. HTTP는 자신의 메시지 데이터를 전송하기 위해 TCP를 사용합니다. 이와 비슷하게 TCP는 IP 윗 계층입니다.

 

|                 HTTP  (애플리케이션 계층)                  |
| :--------------------------------------------------------: |
|                  **TCP** **(전송 계층)**                   |
|                 **IP** **(네트워크 계층)**                 |
| **네트워크를 위한 링크 인터페이스** **(데이터 링크 계층)** |
|       **물리적인 네트워크 하드웨어** **(물리 계층)**       |

### 1-6-2. 접속, IP 주소 그리고 포트 번호

클라이언트가 서버로 HTTP 요청을 보내기 전에, IP(Internet 프로토콜) 주소와 포트번호를 사용해 클라이언트와 서버 사이에 TCP/IP 커넥션을 맺어야 합니다. TCP 커넥션을 맺는 것은 다른 회사 사무실에 있는 사람에게 전화를 거는 것과 비슷합니다. 먼저 회사 전화번호를 누르면 그 회사로 연결됩니다. 그 다음 상대방의 번호를 누르는 것과 비슷하다고 보시면 됩니다.

TCP에서는 서버 컴퓨터 IP 주소와 그 서버에서 실행중인 프로그램이 사용중인 포트번호가 필요합니다. 그렇다면 HTTP 서버의 IP 주소와 포트번호를 어떻게 알아낼 수 있을까요? URL에서 알아낼 수 있습니다.

- http://207.200.83.29:80/index.html
- http://www.netscape.com:80/index.html
- http://www.netscape.com/index.html

첫번째 URL 주소를 보면 IP 주소와 포트번호를 가지고 있는 것을 볼 수 있습니다. 

두번째 URL에는 IP 주소가 없습니다. 대신 글자로 된 도메인 명 혹은 호스트 명을 가지고 있습니다. 호스트 명은 IP 주소를 인간이 이해하기 쉬운 형태로 만들어 놓은 별명이라 생각하시면 됩니다. 호스트 명은 도메인 이름 서비스(Domain Name Service, DNS)를 통해 IP주소로 변환됩니다. 

마지막 URL에는 포트 번호가 없습니다. HTTP URL에서 포트번호가 없다면 기본 값 80이라고 가정하면 됩니다. 

IP 주소와 포트번호를 통해 클라이언트는 서버와 TCP/IP 로 통신할 수 있게됩니다. 

순서는 다음과 같습니다.

1. 웹브라우저는 서버의 URL에서 호스트명을 추출한다.
2. 웹브라우저는 서버의 호스트 명을 IP로 변환한다.
3. 웹브라우저는 URL에서 포트번호를 추출한다. (기본값 80) 
4. 웹브라우저는 이를 통해 웹서버와 TCP 커넥션을 맺는다.
5. 웹브라우저는 서버에 HTTP 요청을 보낸다.
6. 서버는 웹브라우저에 HTTP 응답을 돌려준다.
7. 커넥션이 닫히면, 웹브라우저는 사용자에게 문서를 보여준다.  

### 1-7. 웹의 구성요소

**프락시**

클라이언트와 서버 사이에 위치한 HTTP 중재자

**캐시**

많이 찾는 웹 페이지를 클라이언트 가까이에 보관하는 HTTP 창고

**게이트웨이**

다른 애플리케이션과 연결된 특별한 웹 서버

**터널**

단순히 HTTP 통신을 전달하기만 하는 특별한 프락시

**에이전트**

자동화된 HTTP 요청을 만드는 준 지능적 웹 클라이언트

### 1-7-1. 프락시

프락시는 클라이언트와 서버 사이에 위치하여, 클라이언트의 모든 HTTP 요청을 받아 서버에 전달합니다. 프락시는 주로 보안을 위해 사용됩니다. 즉, 모든 웹 트래픽 흐름 속에서 신뢰할 만한 중재자 역할을 맡고 있습니다. 또한 요청과 응답을 필터링합니다. 예를 들어, 회사에서 다운 받은 정보로부터 바이러스를 검출하거나 미성년자가 성인컨텐츠에 접근하는 것을 차단하는 기능을 합니다. 

### 1-7-2. 캐시

웹 캐시와 캐시 프락시는 자신을 지난 문서들 중 클라이언트가 자주 찾는 문서의 사본을 저장해두는 특별한 형태의 HTTP 프락시 서버입니다. 클라이언트가 같은 문서를 요청하면 캐시가 가지고 있는 사본을 돌려줍니다. 클라이언트는 웹 서버보다 가까운 캐시에서 훨씬 더 빨리 문서를 다운받을 수 있게 됩니다. HTTP는 캐시를 효율적이고 안정적으로 동작하게 하는 많은 기능을 제공합니다.

### 1-7-3. 게이트웨이

게이트웨이는 다른 서버들의 중재자로 동작하는 특별한 서버입니다. 게이트 웨이는 주로 HTTP 트래픽을 다른 프로토콜로 변환하기 위해 사용됩니다. 게이트웨이는 자신이 리소스를 보유한 진짜 서버인것처럼 요청을 처리합니다. 하지만 클라이언트는 자신이 게이트웨이와 통신하고 있다는 것을 알아차리지 못합니다. HTTP/FTP 게이트웨이는 FTP URI에 대한 HTTP 요청을 받은 뒤, 이를 FTP 프로토콜로 변환해 문서를 가져옵니다. 받아온 문서는 HTTP 메시지에 담겨 클라이언트로 전송됩니다.

### 1-8-4. 터널

터널은 두 커넥션 사이에서 raw 데이터를 열어보지않고 그대로 전달하는 HTTP 애플리케이션입니다. HTTP 터널은 주로 비 HTTP 데이터를 하나 이상의 HTTP 연결을 통해 그대로 전송하기 위해서 사용합니다. 그 예로, 암호화된 SSL 트래픽을 HTTP 커넥션으로 전송함으로써 웹 트래픽만 허용하는 사내 방화벽을 통과하는 방법이 있습니다.

### 1-8-5. 에이전트

에이전트는 사용자를 위해 HTTP 요청을 생성해주는 프로그램입니다. 웹 요청을 생성하는 프로그램은 모두 HTTP 에이전트입니다. 대표적인 에이전트로는 브라우저가 있고 다른 여러종류의 에이전트가 존재합니다. 예를 들어, 스스로 웹을 돌아다니며 웹 트랜잭션을 일으키고 콘텐츠를 받아오는 자동화된 에이전트가 존재합니다. 이들은 '스파이더' 나 '웹로봇' 같은 여러가지 이름으로 불리고 있습니다.