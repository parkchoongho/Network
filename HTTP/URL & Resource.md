# URL과 리소스

## 2. URL과 리소스

### 2-1. 인터넷의 리소스 탐색하기

http://www.joes-hardware.com/seasonal/index-fall.html 이라는 URL을 불러온다고 가정해봅시다.

- URL 첫 부분인 http는 URL 스킴입니다. 스킴은 웹 클라이언트가 리소스에 어떻게 접근하는지 알려줍니다. 이 경우는, URL이 http 프로토콜을 사용합니다.
- URL의 두 번째 부분 www.joes-hardware.com 는 서버의 위치입니다. 이는 웹 클라이언트 리소스가 어디에 호스팅 되어있는지 알려줍니다.
- URL의 세 번째 부분 /seasonal/index-fall.html은 리소스 경로입니다. 경로는 서버에 존재하는 로컬 리소스 중 요청받은 리소스가 무엇인지 알려줍니다.

대부분의 URL은 동일하게 '스킴://서버위치/경로' 구조로 구성되어 있습니다. 모든 사람이 같은 방식으로 이름을 써서 리소스를 찾을 수 있도록, 단일 방식의 작명 규칙을 가지게 된 것입니다.

### 2-2. URL 문법

대부분 URL 스킴 문법은 일반적으로 9가지로 나뉘어 집니다.

**<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>**

이 중에 가장 중요한 세가지 컴포넌트는 스킴, 호스트, 경로입니다.

### 2-2-1. 스킴: 사용할 프로토콜

스킴은 주어진 리소스에 어떻게 접근할지를 담고 있는 중요 정보입니다. 이는 URL을 읽어들이는 애플리케이션이 어떤 프로토콜을 사용하여 리소스를 요청해야 하는지를 알려줍니다. 스킴 컴포넌트는 알파벳으로 시작해야 하고 URL의 나머지 부분들과는 첫 번째 ':' 문자로 구분되어 집니다. 스킴명은 대소문자를 가리지 않습니다.

### 2-2-2. 호스트와 포트

인터넷에 있는 리소스를 찾기 위해서는 리소스를 호스팅하고 있는 장비와 그 장비내 서버가 어디 있는지 알아야 합니다. URL의 호스트와 포트 컴포넌트는 그 두가지 정보를 제공합니다.

www.joes-hardware.com 와 161.58.228.45는 같은 것을 나타냅니다. 포트 컴포넌트는 서버가 열어놓은 네트워크 포트를 의미하고 내부적으로 HTTP는 기본 포트로 80을 사용합니다.

### 2-2-3. 사용자 이름과 비밀번호

많은 서버가 자신이 가지고 있는 데이터에 접근을 허용하기 전에 사용자 이름과 비밀번호를 요구합니다. FTP 서버가 그에 대한 예시를 보여줍니다.

ftp://ftp.prep.ai..mit.edu/pub/gnu

ftp://anonymous@ftp.prep.ai..mit.edu/pub/gnu

ftp://anonymous:my_passwd@ftp.prep.ai..mit.edu/pub/gnu

첫 번째 예시를 보면 사용자 이름과 비밀번호 없이 스킴과 호스트, 경로만 존재합니다. 애플리케이션이 FTP 같이 사용자 이름과 비밀번호가 필요한 URL 스킴을 사용하는데 값들이 입력되어 있지 않은 경우, 기본 사용자 이름과 비밀번호를 적용합니다.

### 2-2-4. 경로

URL의 경로 컴포넌트는 리소스가 서버 어디에 위치해 있는지 알려줍니다. 해당 경로는 밑에 예시처럼 계층적 파일 시스템 경로와 유사한 구조를 가지고 있습니다.

http://www.joes-hardware.com:80/seasonal/index-fall.html

경로는 서버가 리소스의 위치를 찾는데 사용하는 정보입니다. HTTP URL에서 경로 컴포넌트는 `'/'` 문자를 기준으로 나눠지고 각각이 경로조각이 됩니다. 각 경로조각은 자기만의 파라미터 컴포넌트를 가질 수 있습니다.

### 2-2-5. 파라미터

많은 스킴이 호스트 및 경로 정보만으로 리소스를 찾지 못합니다. 포트 번호, 사용자 이름, 비밀번호 외에도 더 많은 정보를 요구합니다. URL을 사용하는 애플리케이션이 리소스에 접근하기 위해서 파라미터가 필요한 경우도 있습니다. 이 경우 파라미터가 없으면, 서버는 그 요청을 잘못 처리하거나 처리하지 않을 수 있습니다. FTP의 경우 총 2개 (바이너리와 텍스트) 포맷을 지원하는데, 사용자는 바이너리 이미지가 텍스트 형식으로 전송되는 것을 원하지 않을 것입니다. URL 파라미터 컴포넌트는 서버에 정확한 요청을 하기 위해 필요한 입력값을 받는데 활용됩니다. 이 컴포넌트는 이름/값 쌍의 리스트로 URL 나머지 부분들로 부터 `;` 문자로 구분하여 URL에 기술합니다.

`ftp://prep.ai.mit.edu/pub/gnu;type=d`

이 경우 이름은 type이고 값은 d인 한쌍의 파라미터를 전달합니다. 앞서 말햇듯, HTTP URL에서 경로 컴포넌트는 경로 조각으로 나뉘고 각각의 조각은 자체 파라미터를 가질 수 있습니다. 예를 들어,

http://www.joes-hardware.com/hammers;sale=false/index.html;graphics=true

위 URL의 경우 hammers와 index.html 두개의 경로 조각이 있고 hammers 경로조각은 false 값을 가지는 sale 파라미터를 가지고 index.html 경로조각은 true 값을 가지는 graphics 파라미터를 가지게 됩니다.

### 2-2-6. 질의 문자열

데이터 베이스 같은 프로그램들은 요청받을 리소스 형식 범위를 좁히기 위해 질문이나 질의를 받을 수 있습니다. 조의 컴퓨터 가게에서 상품 재고 리스트가 있고 이를 조회할 수 있다고 가정해 봅시다.

http://www.joes-hardware.com/inventory-check.cgi?item=12731

? 우측에 주목해봅시다. 이를 질의 컴포넌트라고 합니다. URL의 질의 컴포넌트는 게이트 웨이를 가리키는 URL의 경로 컴포넌트와 함께 전달되고 있습니다. 보통 게이트웨이는 다른 애플리케이션에 접근할 때 거치는 통로입니다. 편의상 많은 게이트웨이가 '&'로 나뉜 '이름=값' 쌍 형식의 질의 문자열을 원합니다.

http://www.joes-hardware.com/inventory-check.cgi?item=12731&color=blue

위 예시에는 두개의 질의 컴포넌트가 존재합니다. `item=12731`, `color=blue`.

### 2-2-7. 프래그먼트

HTML 같은 리소스 형식들은 더 작게 나뉘어질 수 있습니다. 예를 들어 절이 포함된 큰 텍스트 문자의 경우, 그 리소스에 대한 URL은 텍스트 전체를 의미하지만, 이상적으로 리소스 안에 있는 특정 절을 가리키는 것이 편한 상황이 존재합니다. 프래그먼트는 URL 오른쪽 # 문자에 이어서 옵니다.

http://www.joes-hardware.com/tools.html#drills

여기서 drills라는 프래그먼트는 /tools.html 웹 페이지의 일부를 나타냅니다. 일반적으로 HTTP 서버는 객체 일부가 아닌 전체만을 다루기에, 클라이언트는 서버에 프래그먼트를 전달하지 않습니다. 브라우저가 서버로부터 전체 리소스를 내려받은 후, 프래그먼트를 사용하여 보고자하는 리소스의 일부를 보여줍니다.

### 2-3. 단축 URL

웹 클라이언트는 몇몇 단축 URL을 사용합니다. 상대 URL은 리소스 안에 있는 리소스를 간결하게 기술하는데 활용됩니다. 많은 브라우저가 사용자가 일부 URL만 입력하면 나머지 부분을 자동으로 입력해주는 URL '자동확장'을 지원합니다.

### 2-3-1. 상대 URL

URL은 상대 URL과 절대 URL로 나누어집니다. 절대 URL은 리소스에 접근하는데 필요한 모든 정보를 가지고 있습니다. 그와 달리 상대 URL은 일부 정보만을 가지고 있습니다. 상대 URL로 리소스 접근에 필요한 모든 정보를 얻으려면, 기저(base)라고 하는 URL을 사용해야 합니다. 상대 URL은 URL을 짧게 표기하는 방식입니다. 

```html
<html>
    <head>
        <title>Joe's Tools</title>
    </head>
    <body>
       <h1>
           Tools Page
       </h1>
       <a href="./hammers.html">Hammers</a>
    </body>
</html>
```

위 HTML 문서에서는 `./hammers.html` 을 가리키는 하이퍼링크가 존재합니다. 이 URL은 미완성인 것처럼 보이나, 올바른 상대 URL입니다. 상대 URL에 따르면, HTML 작성자는 URL에 스킴과 호스트 그리고 다른 컴포넌트들을 모두 입력하지 않아도 됩니다. 그 정보는 컴포넌트가 포함된 리소스의 기저 URL로부터 알아낼 수 있습니다. 위의 html 문서의 경우 기저 URL은 `http://www.joes-hardware.com/tools.html`입니다. 이 URL을 기저 URL로 사용하여, 상대 URL에서는 기술하지 않은 정보를 추측할 수 있습니다. 필요한 리소스가  `./hammers.html`이고 기저 URL을 활용하면 스킴은 http이고 호스트는 www.joes-hardware.com 이란 것을 추측할 수 있습니다.

상대 URL은 프래그먼트이거나 URL의 일부입니다. URL을 처리하는 브라우저 같은 프로그램은 상대 URL과 절대 URL간에 상호 변환이 가능해야 합니다. 상대 URL을 사용하면 리소스 집합을 쉽게 변경할 수 있습니다.

**기저 URL**

변환 과정의 첫 단계는 기저 URL을 찾는 것입니다. 기저 URL은 상대 URL의 기준이 됩니다.

**리소스에서 명시적으로 제공**

어떤 리소스들은 기저 URL을 명확하게 기술하기도 합니다. 그 예로, HTML 문서에서는 그 안에 있는 모든 상대 URL을 변경하기 위해 기저 URL을 가리키는 <base> 태그를 기술할 수 있습니다.

**리소스를 포함하고 있는 기저 URL**

만약 상대 URL이 기저 URL이 명시되지 않은 리소스에 포함되어 있을 경우, 해당 리소스의 URL을 기저 URL로 쓸 수 있습니다.

**기저 URL이 없는 경우**

이런 경우에는 절대 URL만으로 이루어졌다는 뜻입니다. 하지만 불완전하고 깨진 URL일 가능성이 높습니다.

**상대 참조 해석**

상대 URL을 절대 URL로 변환하기 위한 다음 단계는 상대 URL과 기저 URL을 각각의 컴포넌트 조각으로 나누는 것입니다. 사실 이 작업은 URL을 파싱하는 것이지만, 컴포넌트로 분리한다는 점에서 이 작업을  'URL 분해하기'라 칭하기도 합니다. 분해하기가 완료되면 알고리즘을 활용하여 상대 경로를 절대 경로 형태로 변환합니다.

### 2-3-2. URL 확장

브라우저들 중에는 URL을 입력한 다음이나 입력하고 있는 도중 자동으로 URL을 확장하는 기능을 제공합니다. 이는 사용자가 URL을 빠르게 입력할 수 있도록 도와줍니다. 자동으로 URL이 확장되기에 URL 전체를 입력하지 않아도 되는 것 입니다. 이러한 '확장' 기능은 두가지로 나누어 집니다.

**호스트 명 확장**

호스트 명 확장 기능을 지원하는 브라우저는 단순한 휴리스틱만을 사용해서 입력한 호스트 명을 전체 호스트명으로 확장할 수 있습니다. 예를 들어 주소 입력란에 'yahoo'를 입력하면, 브라우저는 호스트명에 자동으로 'www.' 와 '.com' 을 붙여 'www.yahoo.com' 을 만들어 줍니다. 어떤 브라우저는 'yahoo'란 단어를 포함한 사이트를 찾지 못할 경우, 확장을 포기하기 전에 몇가지 URL을 추가로 제시합니다. 이러한 호스트명 확장 기능은 프락시와 같은 다른 HTTP 애플리케이션에 문제를 발생시킬 수도 있습니다.

**히스토리 확장**

브라우저가 사용하는 다른 기술은 과거에 사용자가 방문했던 URL 기록을 저장해 놓는 것입니다. URL을 입력하면, 입력된 URL의 앞 글자들을 포함하는 완결된 URL들을 선택하게 해줍니다. 그러면 사용자는 전체 URL을 입력하는 대신 선택만 하면 됩니다. 그런데 프락시를 사용할 경우 URL 자동 확장 기능은 다르게 동작할 수 있습니다. 이 점에 주의합시다.

### 2-4. 안전하지 않은 문자

### 2-4-1. URL 문자 집합

컴퓨터 시스템의 기본 문자 집합은 대개 영어중심으로 되어 있습니다. 많은 애플리케이션이 US-ASCII 문자 집합을 사용해 왔습니다. 하지만 이는 전 세계 십수억의 사람들이 사용하는 다른 언어들까지 고려하고 있지 않습니다. 그뿐만 아니라 URL이 특정 이진 데이터를 포함해야하는 경우도 있습니다. 이러한 영역까지 다루기 위해, URL 설계자들은 URL에 이스케이프 문자열을 사용할 수 있게 설계하였습니다.

### 2-4-2. 인코딩 체계

안전한 문자집합을 이용할 때 그 표현 방식의 한계를 극복하기 위해, URL에 있는 안정하지 않은 문자들을 표현 가능한 인코딩 방식이 고안되었습니다. 인코딩은 안전하지 않은 문자를 퍼센티지 기호(%)로 시작해, ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 '이스케이프' 문자로 바꾸어줍니다.

### 2-4-3. 문자제한

몇몇 문자는 URL 내에서 특별한 의미로 예약되어 있습니다. URL에서 예약된 문자들을 본래의 목적이 아닌 다른 용도로 사용하려면, 반드시 그 전에 인코딩 처리를 거쳐야합니다. (표가 있는데 그 부분은 나중에 기록하겠습니다.)